#!/usr/bin/env ruby

$LOAD_PATH.unshift File.expand_path('../../lib', __FILE__)

require 'yarn'
require 'choice'

PROGRAM_VERSION = Yarn::VERSION

Choice.options do
  header 'Yarn webserver'
  header ''
  header 'Specific options: '

  option :host do
    short '-h'
    long '--host=HOST'
    desc 'Hostname or IP address of the server (default 127.0.0.1)'
    default '127.0.0.1'
  end

  option :port do
    short '-p'
    long '--port=PORT'
    desc 'Port number to listen on for incomming requests (default 21)'
    validate /^\d+$/
    cast Integer
    default 3000
  end
# 
#   option :type do
#     short '-t'
#     long '--type=TYPE'
#     desc 'Server type; static, dynamic or rack'
#     cast Symbol
#     default :static
#   end

  option :debug do
    short '-d'
    long '--debug'
    desc 'Include debug messages in the log (default: off)'
    default 'off'
  end

  separator ''
  separator 'Common options: '

  option :version do
    short '-v'
    long '--version'
    desc 'Show version'
    action do
      puts "Yarn v#{PROGRAM_VERSION}"
      exit
    end

  end
end

if Choice.choices.debug && Choice.choices.debug != 'off'
  debug = true
else
  debug = false
end

options = { host: Choice.choices[:host], port: Choice.choices[:port] }
server = Yarn::Server.new(options)
server.start
